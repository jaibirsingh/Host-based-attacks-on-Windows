# Exploiting Microsoft IIS and WebDAV

## What is IIS
* Proprietary extensible web server software developed by Microsoft for use with thw Windows NT family.
* Used to host websites as it provides administrators with a robust GUI for managing websites.
* Used to host both static and dynamic web pages developed in ASP.NET and PHP.
* Typically configured to run ports 80 (without SSL) /443 (With SSL).
* Supportable file extensions:
  * .asp
  * .aspx
  * .config
  * .php
 
## What is WebDAV (Web-based Distriobuted Authoring and Versioning)
* A set of extensions to the HTTP protocol which allows users to collaboratively edit and manage files on remote web servers.
* It enables a web server (like IIS) to function as a file server for collaborative authoring.
* It can run on top of Apache server or Microsoft IIS on ports 80 (without SSL) and 443 (in case if SSL is configured)
* **How to connect to a WebDAV server**
 * I need to provide legitimate credentials.
 * I can connect to a WebDAV server by accessing the Microsoft IIS through a web browser, and specifying the WebDAV as the folder as specified in the lab work.

## WebDAV exploitation
* First step: Identifying whether WebDAV has been configured to run on the IIS web server/ Apache --> ties to the Enumeration part.
   * `nmap -sV -sC [IP]`
   * `nmap -sV --script=http-enum [IP]`
* Then we can perform a brute force attack on the WebDAV server --> To identify legitimate credentials that can be used for authentication (If authentication nopt configured, then access is relatively easier).
   * `hydra -L [List of usernames] -P [List of passwords] [IP] http-get [name of the directory which contains the authentication form on which the brute force attack is performed]`
 
* To check what types of files extensions we can upload on the target system,
   * `davtest -url [http://IP/webdav/] -auth username:password`
* Then authenticate with the WebDAV server --> Upload a malicious payload with an acceptable file extension from the last step --> Used to execute arbitrary commands or obtain a reverse shell on the target

* **Tools to automate this process**
  1. davtest
     * Used to scan, authenticate and exploit a WebDAV server
     * Pre-installed on most offensive penetration testing distributions like Kali and Parrot OS
    
  2. Cadaver
     * It supports --> File upload + Download, on-screen display, in-place editing, namespace operations (move/copy), collection creation and deletion, property manipulation, and resource locking on WebDAV servers.
     * Pre-installed on most offensive penetration testing distributions like Kali and Parrot OS.
     * `cadaver http://[IP]/webdav`  --> This will ask for username/password.
     * Then we can add **webshells** to the remote system to gain access to execute commands.
     * Kali Linux comes with pre-packaged web shells which can be accessed through:
       * `ls /usr/share/webshells` --> then look for the webshell under the folder with the suitable file extension name.
       * After knowing the path of the suitable webshell, go back to the cadaver context:
       * `put /usr/share/webshells/[path]`
       * Now go to the GUI, you will be able to see this webshell in the contents of /webdav/. Click on the webshell name to execute it.
       * This execution will give access to a box where can be written and executed.
